"use strict";

var _express = _interopRequireDefault(require("express"));
var _types = require("./types");
var _fs = _interopRequireDefault(require("fs"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
const CURR_PATH = import.meta.dirname;
const API_PREFIX = '/api';
(async () => {
  const app = (0, _express.default)();
  const port = process.env.PORT || 8080;
  const loop = async (fullPath, path) => {
    const folderContent = await _fs.default.readdirSync(fullPath);
    for (const i in folderContent) {
      const filePath = `${fullPath}/${folderContent[i]}`;
      const file = await _fs.default.lstatSync(filePath);
      if (file.isDirectory()) {
        loop(filePath, `${path}/${folderContent[i]}`);
        continue;
      }
      let routePath = path;
      if (!folderContent[i].startsWith("+index.")) routePath = `${routePath}/${folderContent[i].split('.')[0]}`;
      console.log(routePath);
      const route = await (specifier => new Promise(r => r(`${specifier}`)).then(s => _interopRequireWildcard(require(s))))(filePath);
      switch (route.request) {
        case _types.Request.GET:
          app.get(routePath, route.callback);
          break;
        case _types.Request.POST:
          app.post(routePath, route.callback);
          break;
        default:
          console.log(`Followind file is not a route: ${filePath}`);
      }
    }
  };
  try {
    loop(`${CURR_PATH}/routes`, API_PREFIX);
  } catch (e) {
    console.error(e);
    process.exit(-1);
  }
  app.listen(port, () => {
    console.log(`Listening on port ${port}`);
  });
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3R5cGVzIiwiX2ZzIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiV2Vha01hcCIsInIiLCJ0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJoYXMiLCJnZXQiLCJuIiwiX19wcm90b19fIiwiYSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwidSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImkiLCJzZXQiLCJDVVJSX1BBVEgiLCJpbXBvcnQiLCJtZXRhIiwiZGlybmFtZSIsIkFQSV9QUkVGSVgiLCJhcHAiLCJleHByZXNzIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwibG9vcCIsImZ1bGxQYXRoIiwicGF0aCIsImZvbGRlckNvbnRlbnQiLCJmcyIsInJlYWRkaXJTeW5jIiwiZmlsZVBhdGgiLCJmaWxlIiwibHN0YXRTeW5jIiwiaXNEaXJlY3RvcnkiLCJyb3V0ZVBhdGgiLCJzdGFydHNXaXRoIiwic3BsaXQiLCJjb25zb2xlIiwibG9nIiwicm91dGUiLCJzcGVjaWZpZXIiLCJQcm9taXNlIiwidGhlbiIsInMiLCJyZXF1ZXN0IiwiUmVxdWVzdCIsIkdFVCIsImNhbGxiYWNrIiwiUE9TVCIsInBvc3QiLCJlcnJvciIsImV4aXQiLCJsaXN0ZW4iXSwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIlxuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgZnMgZnJvbSBcImZzXCJcblxuY29uc3QgQ1VSUl9QQVRIOiBzdHJpbmcgPSBpbXBvcnQubWV0YS5kaXJuYW1lXG5jb25zdCBBUElfUFJFRklYOiBzdHJpbmcgPSAnL2FwaSdcblxuOyhhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgYXBwID0gZXhwcmVzcygpXG4gICAgY29uc3QgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgODA4MDtcbiAgICBcbiAgICBjb25zdCBsb29wID0gYXN5bmMgKGZ1bGxQYXRoOiBzdHJpbmcsIHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBmb2xkZXJDb250ZW50ID0gYXdhaXQgZnMucmVhZGRpclN5bmMoZnVsbFBhdGgpXG4gICAgICAgIGZvciAoY29uc3QgaSBpbiBmb2xkZXJDb250ZW50KSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke2Z1bGxQYXRofS8ke2ZvbGRlckNvbnRlbnRbaV19YFxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IGZzLmxzdGF0U3luYyhmaWxlUGF0aClcblxuICAgICAgICAgICAgaWYgKGZpbGUuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgIGxvb3AoZmlsZVBhdGgsIGAke3BhdGh9LyR7Zm9sZGVyQ29udGVudFtpXX1gKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCByb3V0ZVBhdGggPSBwYXRoXG4gICAgICAgICAgICBpZiAoIWZvbGRlckNvbnRlbnRbaV0uc3RhcnRzV2l0aChcIitpbmRleC5cIikpXG4gICAgICAgICAgICAgICAgcm91dGVQYXRoID0gYCR7cm91dGVQYXRofS8ke2ZvbGRlckNvbnRlbnRbaV0uc3BsaXQoJy4nKVswXX1gXG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJvdXRlUGF0aClcblxuICAgICAgICAgICAgY29uc3Qgcm91dGUgPSBhd2FpdCBpbXBvcnQoZmlsZVBhdGgpXG4gICAgICAgICAgICBzd2l0Y2ggKHJvdXRlLnJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFJlcXVlc3QuR0VUOlxuICAgICAgICAgICAgICAgICAgICBhcHAuZ2V0KHJvdXRlUGF0aCwgcm91dGUuY2FsbGJhY2spXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgUmVxdWVzdC5QT1NUOlxuICAgICAgICAgICAgICAgICAgICBhcHAucG9zdChyb3V0ZVBhdGgsIHJvdXRlLmNhbGxiYWNrKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRm9sbG93aW5kIGZpbGUgaXMgbm90IGEgcm91dGU6ICR7ZmlsZVBhdGh9YClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIGxvb3AoYCR7Q1VSUl9QQVRIfS9yb3V0ZXNgLCBBUElfUFJFRklYKVxuICAgIH0gY2F0Y2goZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGUpXG4gICAgICAgIHByb2Nlc3MuZXhpdCgtMSlcbiAgICB9XG5cbiAgICBhcHAubGlzdGVuKHBvcnQsICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYExpc3RlbmluZyBvbiBwb3J0ICR7cG9ydH1gKVxuICAgIH0pXG5cbn0pKClcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxNQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxHQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFBbUIsU0FBQUQsdUJBQUFJLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFBQSxTQUFBRyx5QkFBQUgsQ0FBQSw2QkFBQUksT0FBQSxtQkFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFBRCx3QkFBQSxZQUFBQSxDQUFBSCxDQUFBLFdBQUFBLENBQUEsR0FBQU0sQ0FBQSxHQUFBRCxDQUFBLEtBQUFMLENBQUE7QUFBQSxTQUFBTyx3QkFBQVAsQ0FBQSxFQUFBSyxDQUFBLFNBQUFBLENBQUEsSUFBQUwsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsU0FBQUQsQ0FBQSxlQUFBQSxDQUFBLHVCQUFBQSxDQUFBLHlCQUFBQSxDQUFBLFdBQUFFLE9BQUEsRUFBQUYsQ0FBQSxRQUFBTSxDQUFBLEdBQUFILHdCQUFBLENBQUFFLENBQUEsT0FBQUMsQ0FBQSxJQUFBQSxDQUFBLENBQUFFLEdBQUEsQ0FBQVIsQ0FBQSxVQUFBTSxDQUFBLENBQUFHLEdBQUEsQ0FBQVQsQ0FBQSxPQUFBVSxDQUFBLEtBQUFDLFNBQUEsVUFBQUMsQ0FBQSxHQUFBQyxNQUFBLENBQUFDLGNBQUEsSUFBQUQsTUFBQSxDQUFBRSx3QkFBQSxXQUFBQyxDQUFBLElBQUFoQixDQUFBLG9CQUFBZ0IsQ0FBQSxPQUFBQyxjQUFBLENBQUFDLElBQUEsQ0FBQWxCLENBQUEsRUFBQWdCLENBQUEsU0FBQUcsQ0FBQSxHQUFBUCxDQUFBLEdBQUFDLE1BQUEsQ0FBQUUsd0JBQUEsQ0FBQWYsQ0FBQSxFQUFBZ0IsQ0FBQSxVQUFBRyxDQUFBLEtBQUFBLENBQUEsQ0FBQVYsR0FBQSxJQUFBVSxDQUFBLENBQUFDLEdBQUEsSUFBQVAsTUFBQSxDQUFBQyxjQUFBLENBQUFKLENBQUEsRUFBQU0sQ0FBQSxFQUFBRyxDQUFBLElBQUFULENBQUEsQ0FBQU0sQ0FBQSxJQUFBaEIsQ0FBQSxDQUFBZ0IsQ0FBQSxZQUFBTixDQUFBLENBQUFSLE9BQUEsR0FBQUYsQ0FBQSxFQUFBTSxDQUFBLElBQUFBLENBQUEsQ0FBQWMsR0FBQSxDQUFBcEIsQ0FBQSxFQUFBVSxDQUFBLEdBQUFBLENBQUE7QUFFbkIsTUFBTVcsU0FBaUIsR0FBR0MsTUFBTSxDQUFDQyxJQUFJLENBQUNDLE9BQU87QUFDN0MsTUFBTUMsVUFBa0IsR0FBRyxNQUFNO0FBRWhDLENBQUMsWUFBWTtFQUNWLE1BQU1DLEdBQUcsR0FBRyxJQUFBQyxnQkFBTyxFQUFDLENBQUM7RUFDckIsTUFBTUMsSUFBSSxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsSUFBSSxJQUFJLElBQUk7RUFFckMsTUFBTUMsSUFBSSxHQUFHLE1BQUFBLENBQU9DLFFBQWdCLEVBQUVDLElBQVksS0FBSztJQUNuRCxNQUFNQyxhQUFhLEdBQUcsTUFBTUMsV0FBRSxDQUFDQyxXQUFXLENBQUNKLFFBQVEsQ0FBQztJQUNwRCxLQUFLLE1BQU1kLENBQUMsSUFBSWdCLGFBQWEsRUFBRTtNQUMzQixNQUFNRyxRQUFRLEdBQUcsR0FBR0wsUUFBUSxJQUFJRSxhQUFhLENBQUNoQixDQUFDLENBQUMsRUFBRTtNQUNsRCxNQUFNb0IsSUFBSSxHQUFHLE1BQU1ILFdBQUUsQ0FBQ0ksU0FBUyxDQUFDRixRQUFRLENBQUM7TUFFekMsSUFBSUMsSUFBSSxDQUFDRSxXQUFXLENBQUMsQ0FBQyxFQUFFO1FBQ3BCVCxJQUFJLENBQUNNLFFBQVEsRUFBRSxHQUFHSixJQUFJLElBQUlDLGFBQWEsQ0FBQ2hCLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDN0M7TUFDSjtNQUVBLElBQUl1QixTQUFTLEdBQUdSLElBQUk7TUFDcEIsSUFBSSxDQUFDQyxhQUFhLENBQUNoQixDQUFDLENBQUMsQ0FBQ3dCLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFDdkNELFNBQVMsR0FBRyxHQUFHQSxTQUFTLElBQUlQLGFBQWEsQ0FBQ2hCLENBQUMsQ0FBQyxDQUFDeUIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO01BRWhFQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0osU0FBUyxDQUFDO01BRXRCLE1BQU1LLEtBQUssR0FBRyxPQUFBQyxTQUFBLFFBQUFDLE9BQUEsQ0FBQTVDLENBQUEsSUFBQUEsQ0FBQSxJQUFBMkMsU0FBQSxLQUFBRSxJQUFBLENBQUFDLENBQUEsSUFBQTVDLHVCQUFBLENBQUFWLE9BQUEsQ0FBQXNELENBQUEsS0FBYWIsUUFBUSxDQUFDO01BQ3BDLFFBQVFTLEtBQUssQ0FBQ0ssT0FBTztRQUNqQixLQUFLQyxjQUFPLENBQUNDLEdBQUc7VUFDWjVCLEdBQUcsQ0FBQ2pCLEdBQUcsQ0FBQ2lDLFNBQVMsRUFBRUssS0FBSyxDQUFDUSxRQUFRLENBQUM7VUFDbEM7UUFDSixLQUFLRixjQUFPLENBQUNHLElBQUk7VUFDYjlCLEdBQUcsQ0FBQytCLElBQUksQ0FBQ2YsU0FBUyxFQUFFSyxLQUFLLENBQUNRLFFBQVEsQ0FBQztVQUNuQztRQUNKO1VBQ0lWLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGtDQUFrQ1IsUUFBUSxFQUFFLENBQUM7TUFDakU7SUFDSjtFQUNKLENBQUM7RUFFRCxJQUFJO0lBQ0FOLElBQUksQ0FBQyxHQUFHWCxTQUFTLFNBQVMsRUFBRUksVUFBVSxDQUFDO0VBQzNDLENBQUMsQ0FBQyxPQUFNekIsQ0FBQyxFQUFFO0lBQ1A2QyxPQUFPLENBQUNhLEtBQUssQ0FBQzFELENBQUMsQ0FBQztJQUNoQjZCLE9BQU8sQ0FBQzhCLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUNwQjtFQUVBakMsR0FBRyxDQUFDa0MsTUFBTSxDQUFDaEMsSUFBSSxFQUFFLE1BQU07SUFDbkJpQixPQUFPLENBQUNDLEdBQUcsQ0FBQyxxQkFBcUJsQixJQUFJLEVBQUUsQ0FBQztFQUM1QyxDQUFDLENBQUM7QUFFTixDQUFDLEVBQUUsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==